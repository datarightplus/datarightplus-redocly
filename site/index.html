<!DOCTYPE html>
<html>
  <head>
    <title>DataRight Plus: Redocly</title>
    <!-- needed for adaptive design -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/png" href="favicon.ico">
    <style>
      body {
        margin: 0;
        padding-top: 40px;
      }

      nav {
        position: fixed;
        top: 0;
        width: 100%;
        z-index: 100;
      }
      #links_container {
        margin: 0;
        padding: 0;
        background-color: rgb(245, 246, 250);
      }

      #links_container li {
        display: inline-block;
        padding: 10px;
        color: rgb(114, 83, 237);
        cursor: pointer;
      }
    </style>
  </head>
  <body>

  <!-- Top navigation placeholder -->
  <nav>
    <ul id="links_container"></ul>
  </nav>
  <redoc scroll-y-offset="body > nav"></redoc>
  <script src="https://cdn.redoc.ly/redoc/latest/bundles/redoc.standalone.js"></script>
  <script>
    var apis = [
      {
        name: 'latest',
        url: 'openapi.yaml'
      }
    ];

    // initially render first API
    Redoc.init(apis[0].url);

    function onClick() {
      var url = this.getAttribute('data-link');
      Redoc.init(url);
    }

    // dynamically building navigation items
    var $list = document.getElementById('links_container');
    var $listitem = document.createElement('li');
    $listitem.innerText = "<< Return to DataRight+";
    $listitem.addEventListener('click', function() { window.location = "https://dataright.plus";});
    $list.appendChild($listitem);
    $listitem.innerText = "latest";
    $listitem.setAttribute('data-link', "openapi.yaml");
    $listitem.addEventListener('click', onClick);
    $list.appendChild($listitem);

    (async () => {
      const res = await fetch('https://api.github.com/repos/datarightplus/datarightplus-redocly/releases', {
        headers: { Accept: 'application/json' },
      });
      const json = await res.json();
      json.forEach((release) => {
        var $listitem = document.createElement('li');
        $listitem.setAttribute('data-link', release.assets.filter(function (entry) { return entry.name == "openapi.yaml"; })[0].browser_download_url);
        $listitem.innerText = release.name;
        $listitem.addEventListener('click', onClick);
        $list.appendChild($listitem);
      });
    })();
  </script>
  </body>
</html>
